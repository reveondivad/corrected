<?php
$rootUname = htmlspecialchars($_GET['rootUname']);
$array = array();
/* check PHP Safe_Mode is off */
if (ini_get('safe_mode')) {
    $array['phpSafeMode'] = '<strong><span class=""bad"">Fail - php safe mode is on - turn it off before you proceed with the installation</span></strong><br/>';
} else {
    $array['phpSafeMode'] = '<strong><span class=""Good"">Pass - php safe mode is off</strong></span><br/>';
}
/* Test root account details */
$rootUnameEscaped = escapeshellarg($rootUname);
$rootTestCmd1 = 'sudo -S -u ' . $rootUnameEscaped . ' chmod 0777 /home 2>&1';
exec($rootTestCmd1, $cmdOutput, $err);
$homeDirPerms = substr(sprintf('%o', fileperms('/home')), -4);
if ($homeDirPerms == '0777') {
    $array['rootDetails'] = '<strong><span class=""Good"">Pass - root account details are good </strong></span><br/>';
} else {
    $array['rootDetails'] = '<strong><span class=""bad"">The root details provided have not passed: ' . htmlspecialchars($cmdOutput[0]) . '</strong></span><br/>';
}
// reset /home dir permissions
$rootTestCmd2 = 'sudo -S -u ' . $rootUnameEscaped . ' chmod 0755 /home 2>&1';
exec($rootTestCmd2, $cmdOutput, $err);
echo json_encode($array);